var E=Object.defineProperty;var A=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var v=(n,t,e)=>t in n?E(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,S=(n,t)=>{for(var e in t||(t={}))L.call(t,e)&&v(n,e,t[e]);if(A)for(var e of A(t))C.call(t,e)&&v(n,e,t[e]);return n};var p=(n,t,e)=>(v(n,typeof t!="symbol"?t+"":t,e),e);var d=(n,t,e)=>new Promise((r,o)=>{var s=u=>{try{a(e.next(u))}catch(c){o(c)}},i=u=>{try{a(e.throw(u))}catch(c){o(c)}},a=u=>u.done?r(u.value):Promise.resolve(u.value).then(s,i);a((e=e.apply(n,t)).next())});function $$(n){let t=null;if(typeof n=="string"&&(t=document.querySelector(n)),n instanceof HTMLElement&&(t=n),t){const e=t.getAttribute("s:cn");if(e&&e!=""&&typeof window[e]=="function"){const r=new window[e](t);return new __sui_component(t,r)}}return null}function __sui_component_root(n,t){return n.closest(`[s\\:cn=${t}]`)}function __sui_state(n){this.handlers=n.watch||{},this.Set=function(t,e,r){return d(this,null,function*(){var s;const o=this.handlers[t];if(r=r||n.root,o&&typeof o=="function"){if(yield o(e,{target:r,stopPropagation:function(){r.setAttribute("state-propagation","true")}}),r?r.getAttribute("state-propagation")==="true":!1)return;let u=(s=n.root.parentElement)==null?void 0:s.closest("[s\\:cn]");if(u==null)return;const c=new CustomEvent("state:change",{detail:{key:t,value:e,target:n.root}});u.dispatchEvent(c)}})}}function __sui_props(n){this.Get=function(t){if(!n||typeof n.getAttribute!="function")return null;const e="prop:"+t,r=n.getAttribute(e);if(n.getAttribute("json-attr-prop:"+t)==="true")try{return JSON.parse(r)}catch(s){return null}return r},this.List=function(){const t={};if(!n||typeof n.getAttribute!="function")return t;const e=n.attributes;for(let r=0;r<e.length;r++){const o=e[r];if(o.name.startsWith("prop:")){const s=o.name.replace("prop:","");if(n.getAttribute("json-attr-prop:"+s)==="true"){try{t[s]=JSON.parse(o.value)}catch(a){t[s]=null}continue}t[s]=o.value}}return t}}function __sui_component(n,t){this.root=n,this.store=new __sui_store(n),this.props=new __sui_props(n),this.state=t?new __sui_state(t):{};const e=this;this.$root=new __Query(this.root),this.find=function(r){return new __Query(e.root).find(r)},this.query=function(r){return e.root.querySelector(r)},this.queryAll=function(r){return e.root.querySelectorAll(r)},this.emit=function(r,o){const s=new CustomEvent(r,{detail:o});e.root.dispatchEvent(s)},this.render=function(r,o,s){return new __Render(e,s).Exec(r,o)}}function __sui_event_handler(n,t,e,r,o,s){const i={};r=r||null,r&&(t.forEach(function(a){const u=r.getAttribute("data:"+a);i[a]=u}),e.forEach(function(a){const u=r.getAttribute("json:"+a);if(i[a]=null,u&&u!="")try{i[a]=JSON.parse(u)}catch(c){const l=c.message||c||"An error occurred";console.error(`[SUI] Event Handler Error: ${l} `,r)}})),s&&s(n,i,{rootElement:o,targetElement:r})}function __sui_event_init(n){const t=o=>{const s=o.getAttribute("s:event-cn")||"";if(s==""){console.error("[SUI] Component name is required for event binding",n);return}const i={},a=[],u=[];for(let c=0;c<o.attributes.length;c++)if(o.attributes[c].name.startsWith("data:")&&a.push(o.attributes[c].name.replace("data:","")),o.attributes[c].name.startsWith("json:")&&u.push(o.attributes[c].name.replace("json:","")),o.attributes[c].name.startsWith("s:on-")){const l=o.attributes[c].name.replace("s:on-","");i[l]=o.attributes[c].value}for(const c in i){const l=i[c];if(s=="__page"){const y=window[l],m=document.body,b=o;o.addEventListener(c,$=>{__sui_event_handler($,a,u,b,m,y)});continue}const h=o.closest(`[s\\:cn=${s}]`);if(typeof window[s]!="function"){console.error(`[SUI] Component ${s} not found`,o);return}const g=new window[s](h),w=g[l],_=g.root,f=o;o.addEventListener(c,y=>{__sui_event_handler(y,a,u,f,_,w)})}},e=n.querySelectorAll("[s\\:event]"),r=n.querySelectorAll("[s\\:event-jit]");e.forEach(o=>t(o)),r.forEach(o=>t(o))}function __sui_store(n){n=n||document.body,this.Get=function(t){return n.getAttribute("data:"+t)},this.Set=function(t,e){n.setAttribute("data:"+t,e)},this.GetJSON=function(t){const e=n.getAttribute("json:"+t);if(e&&e!="")try{return JSON.parse(e)}catch(r){const o=r.message||r||"An error occurred";return console.error(`[SUI] Event Handler Error: ${o}`,n),null}return null},this.SetJSON=function(t,e){n.setAttribute("json:"+t,JSON.stringify(e))},this.GetData=function(){return this.GetJSON("__component_data")||{}}}function __sui_backend_call(n,t,e,...r){return d(this,null,function*(){const o=`/api/__yao/sui/v1/run${n}`;t=S({"Content-Type":"application/json",Referer:window.location.href,Cookie:document.cookie},t);const s={method:e,args:r};try{const i=JSON.stringify(s),a=yield fetch(o,{method:"POST",headers:t,body:i}),u=yield a.text();let c=null;if(u&&u!=""&&(c=JSON.parse(u)),a.status>=400){const l=c.message?c.message:`Failed to call ${n} ${e}`,h=c.code?c.code:500;return Promise.reject({message:l,code:h})}return Promise.resolve(c)}catch(i){const a=i.message?i.message:`Failed to call ${n} ${e}`,u=i.code?i.code:500;return console.error(`[SUI] Failed to call ${n} ${e}:`,i),Promise.reject({message:a,code:u})}})}function __sui_render(n,t,e,r){return d(this,null,function*(){const o=typeof n=="object"?n:$$(n);if(o==null)return console.error(`[SUI] Component not found: ${n}`),Promise.reject("Component not found");const s=o.root.querySelectorAll(`[s\\:render=${t}]`);if(!s.length)return console.error(`[SUI] No element found with s:render=${t}`),Promise.reject("No element found");r=r||{},r.replace=r.replace===void 0?!0:r.replace,r.showLoader=r.showLoader===void 0?!1:r.showLoader,r.withPageData=r.withPageData===void 0?!1:r.withPageData;let i='<span class="sui-render-loading">Loading...</span>';r.showLoader&&r.replace&&(typeof r.showLoader=="string"?i=r.showLoader:r.showLoader instanceof HTMLElement&&(i=r.showLoader.outerHTML),s.forEach(f=>f.innerHTML=i));let a=o.store.GetData()||{};r.withPageData&&(a=S(S({},a),__sui_data));const u=o.root.closest("[s\\:route]"),c=u?u.getAttribute("s:route"):!1,l=document.body.getAttribute("s:public")||"",h=c?`${l}${c}`:window.location.pathname;r.component=c&&o.root.getAttribute("s:cn")||"";const g=`/api/__yao/sui/v1/render${h}`,w={name:t,data:a,option:r};if(e)for(const f in e)w.data[f]=e[f];const _={"Content-Type":"application/json",Cookie:document.cookie};try{const f=JSON.stringify(w),m=yield(yield fetch(g,{method:"POST",headers:_,body:f})).text();return r.replace&&s.forEach(b=>{b.innerHTML=m,__sui_event_init(b)}),Promise.resolve(m)}catch(f){return s.forEach(y=>{y.innerHTML='<span class="sui-render-error">Failed to render</span>',console.error("Failed to render",f)}),Promise.reject("Failed to render")}})}function $Store(n){if(!n)return null;if(typeof n=="string"){if(n=document.querySelectorAll(n),n.length==0)return null;n=n[0]}return new __sui_store(n)}function $Query(n){return new __Query(n)}class __Query{constructor(t){p(this,"selector","");p(this,"elements",null);p(this,"element",null);typeof t=="string"?(this.selector=t,this.elements=document.querySelectorAll(t),this.elements.length>0&&(this.element=this.elements[0])):this.element=t,this.selector=t}elm(){return this.element}elms(){return this.elements}find(t){var r;const e=(r=this.element)==null?void 0:r.querySelector(t);return e?new __Query(e):null}closest(t){var r;const e=(r=this.element)==null?void 0:r.closest(t);return e?new __Query(e):null}on(t,e){return this.element?(this.element.addEventListener(t,e),this):this}$$(){if(!this.element)return null;const t=this.element.closest("[s\\:cn]");return t?$$(t):null}each(t){this.elements&&this.elements.forEach((e,r)=>{t(new __Query(e),r)})}store(){return!this.element||typeof this.element.getAttribute!="function"?null:new __sui_store(this.element)}attr(t){return!this.element||typeof this.element.getAttribute!="function"?null:this.element.getAttribute(t)}data(t){return!this.element||typeof this.element.getAttribute!="function"?null:this.element.getAttribute("data:"+t)}json(t){if(!this.element||typeof this.element.getAttribute!="function")return null;const e=this.element.getAttribute("json:"+t);if(!e)return null;try{return JSON.parse(e)}catch(r){return console.error(`Error parsing JSON for key ${t}: ${r}`),null}}prop(t){if(!this.element||typeof this.element.getAttribute!="function")return null;const e="prop:"+t,r=this.element.getAttribute(e);if(this.element.getAttribute("json-attr-prop:"+t)==="true"&&r)try{return JSON.parse(r)}catch(s){return console.error(`Error parsing JSON for prop ${t}: ${s}`),null}return r}hasClass(t){var e;return(e=this.element)==null?void 0:e.classList.contains(t)}toggleClass(t){const e=Array.isArray(t)?t:t==null?void 0:t.split(" ");return e==null||e.forEach(r=>{var s;const o=r.replace(/[\n\r\s]/g,"");o!==""&&((s=this.element)==null||s.classList.toggle(o))}),this}removeClass(t){const e=Array.isArray(t)?t:t==null?void 0:t.split(" ");return e==null||e.forEach(r=>{var s;const o=r.replace(/[\n\r\s]/g,"");o!==""&&((s=this.element)==null||s.classList.remove(o))}),this}addClass(t){const e=Array.isArray(t)?t:t==null?void 0:t.split(" ");return e==null||e.forEach(r=>{var s;const o=r.replace(/[\n\r\s]/g,"");o!==""&&((s=this.element)==null||s.classList.add(o))}),this}html(t){var e;return t===void 0?((e=this.element)==null?void 0:e.innerHTML)||"":(this.element&&(this.element.innerHTML=t),this)}}function $Render(n,t){return new __Render(n,t)}class __Render{constructor(t,e){p(this,"comp",null);p(this,"option",null);this.comp=t,this.option=e}Exec(t,e){return d(this,null,function*(){return __sui_render(this.comp,t,e,this.option)})}}function $Backend(n,t){const e=document.body.getAttribute("s:public")||"/";n=n||window.location.pathname;const r=new RegExp("^"+e);return n=e+n.replace(r,""),new __Backend(n,t)}class __Backend{constructor(t,e={}){p(this,"route","");p(this,"headers",{});this.route=t,this.headers=e}Call(t,...e){return d(this,null,function*(){return yield __sui_backend_call(this.route,this.headers,t,...e)})}}function Yao(n){this.host=`${n||window.location.protocol+"//"+window.location.host}/api`,this.query={},new URLSearchParams(window.location.search).forEach((t,e)=>{this.query[t]=e})}Yao.prototype.Get=function(n,t,e){return d(this,null,function*(){return this.Fetch("GET",n,t,null,e)})},Yao.prototype.Post=function(n,t,e,r){return d(this,null,function*(){return this.Fetch("POST",n,e,t,r)})},Yao.prototype.Download=function(n,t,e,r){return d(this,null,function*(){try{const s=yield this.Fetch("GET",n,t,null,r,!0);var o=window.URL.createObjectURL(s);let i=document.createElement("a");document.body.appendChild(i),i.href=o,i.download=e,i.click(),window.URL.revokeObjectURL(o)}catch(s){alert("\u6210\u529F\u521B\u5EFA\u5BFC\u51FA\u4EFB\u52A1!")}})},Yao.prototype.Fetch=function(n,t,e,r,o,s){return d(this,null,function*(){e=e||{},o=o||{},r=r||null;var i=`${this.host}${t}`,a=this.Serialize(e);a!=""&&(i=i.includes("?")?`${i}&${a}`:`${i}?${a}`);const u=this.Token();u!=""&&(o.authorization=`Bearer ${u}`),o["Content-Type"]||(o["Content-Type"]="application/json");var c={method:n,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:o,redirect:"follow"};r!=null&&(c.body=JSON.stringify(r));const l=yield fetch(i,c),h=l.headers.get("Content-Type")||"";if(h.includes("application/json"))try{return yield l.json()}catch(g){return{code:l.status,message:"empty return"}}else{if(s)return l.blob();if(h.includes("text/html")||h.includes("text/plain"))return l.text()}return l.text()})},Yao.prototype.Token=function(){var n=sessionStorage.getItem("token")||"";return n==""?this.Cookie("__tk")||"":n},Yao.prototype.Cookie=function(n){for(var t=n+"=",e=decodeURIComponent(document.cookie),r=e.split(";"),o=0;o<r.length;o++){var s=r[o].trim();if(s.indexOf(t)===0)return s.substring(t.length,s.length)}return null},Yao.prototype.SetCookie=function(n,t,e){e=e||30;var r=new Date;r.setTime(r.getTime()+e*24*60*60*1e3);var o="expires="+r.toUTCString();document.cookie=`${n}=${t};${o};path=/`},Yao.prototype.DeleteCookie=function(n){document.cookie=`${n}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`},Yao.prototype.Serialize=function(n){const t=[];for(const e in n)n.hasOwnProperty(e)&&t.push(encodeURIComponent(e)+"="+encodeURIComponent(n[e]));return t.join("&")};

//# sourceMappingURL=libsui.min.js.map